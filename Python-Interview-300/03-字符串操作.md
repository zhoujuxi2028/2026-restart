# 03 - 字符串操作（20题）

## 难度分布
- 简单：12题
- 中等：6题
- 困难：2题

---

## 第66题：字符串创建与基本操作

**问题**：字符串的创建方式和基本操作

**答案**：
```python
# 创建字符串
s1 = 'hello'
s2 = "world"
s3 = '''多行
字符串'''
s4 = """也可以用
双引号"""

# 转义字符
s = 'hello\nworld'  # 换行
s = 'hello\tworld'  # 制表符
s = 'he\'llo'      # 单引号
s = "hello\\world"  # 反斜杠

# 原始字符串
s = r'C:\new\test'  # 不转义

# 字符串连接
s = 'hello' + ' ' + 'world'
s = 'hello' ' ' 'world'  # 自动连接

# 重复
s = 'ha' * 3  # 'hahaha'

# 长度
print(len('hello'))  # 5

# 访问字符
s = 'hello'
print(s[0])   # 'h'
print(s[-1])  # 'o'
print(s[1:4]) # 'ell'
```

---

## 第67题：字符串格式化

**问题**：Python中的字符串格式化方法

**答案**：
```python
name = 'Alice'
age = 25

# 方法1: % 格式化（旧式）
s = "My name is %s, I'm %d years old" % (name, age)

# 方法2: str.format()
s = "My name is {}, I'm {} years old".format(name, age)
s = "My name is {0}, I'm {1} years old".format(name, age)
s = "My name is {name}, I'm {age} years old".format(name=name, age=age)

# 方法3: f-string（推荐，Python 3.6+）
s = f"My name is {name}, I'm {age} years old"

# 格式化选项
num = 3.141592653
print(f"{num:.2f}")  # 3.14（保留2位小数）
print(f"{num:8.2f}") # "    3.14"（宽度8）
print(f"{num:08.2f}")# "00003.14"（用0填充）

# 进制转换
n = 42
print(f"{n:b}")  # 二进制: 101010
print(f"{n:o}")  # 八进制: 52
print(f"{n:x}")  # 十六进制: 2a
print(f"{n:X}")  # 十六进制大写: 2A

# 对齐
text = "hello"
print(f"{text:<10}")  # 左对齐: "hello     "
print(f"{text:>10}")  # 右对齐: "     hello"
print(f"{text:^10}")  # 居中:   "  hello   "

# 表达式
x, y = 5, 10
print(f"{x + y = }")  # x + y = 15（Python 3.8+）
```

---

## 第68题：字符串查找方法

**问题**：字符串的查找和判断方法

**答案**：
```python
s = "Hello, World!"

# find（找不到返回-1）
print(s.find('World'))   # 7
print(s.find('Python'))  # -1
print(s.find('o'))       # 4（第一次出现）
print(s.find('o', 5))    # 8（从索引5开始）

# rfind（从右边开始查找）
print(s.rfind('o'))      # 8

# index（找不到抛出异常）
print(s.index('World'))  # 7
# print(s.index('Python'))  # ValueError

# count（统计出现次数）
print(s.count('o'))      # 2
print(s.count('l'))      # 3

# in操作符
print('World' in s)      # True
print('Python' in s)     # False

# startswith/endswith
print(s.startswith('Hello'))  # True
print(s.endswith('!'))        # True
print(s.startswith('World', 7))  # True（从索引7开始）

# 实际应用
def check_file_type(filename):
    if filename.endswith('.py'):
        return 'Python文件'
    elif filename.endswith(('.txt', '.md')):
        return '文本文件'
    else:
        return '其他文件'
```

---

## 第69题：字符串替换与删除

**问题**：字符串的替换和删除操作

**答案**：
```python
s = "Hello, World! Hello, Python!"

# replace（替换）
new_s = s.replace('Hello', 'Hi')
print(new_s)  # "Hi, World! Hi, Python!"

# 限制替换次数
new_s = s.replace('Hello', 'Hi', 1)
print(new_s)  # "Hi, World! Hello, Python!"

# 删除（替换为空）
new_s = s.replace('Hello', '')
new_s = s.replace(' ', '')  # 删除所有空格

# strip（删除两端空白）
s = "  hello  "
print(s.strip())   # "hello"
print(s.lstrip())  # "hello  "
print(s.rstrip())  # "  hello"

# 删除指定字符
s = "***hello***"
print(s.strip('*'))  # "hello"

# translate（字符映射）
s = "hello"
trans = str.maketrans('helo', '1234')
print(s.translate(trans))  # "12334"

# 删除标点符号
import string
s = "Hello, World!"
trans = str.maketrans('', '', string.punctuation)
print(s.translate(trans))  # "Hello World"
```

---

## 第70题：字符串大小写转换

**问题**：字符串大小写相关方法

**答案**：
```python
s = "Hello, World!"

# 转换
print(s.upper())      # "HELLO, WORLD!"
print(s.lower())      # "hello, world!"
print(s.swapcase())   # "hELLO, wORLD!"（交换大小写）
print(s.capitalize()) # "Hello, world!"（首字母大写）
print(s.title())      # "Hello, World!"（每个单词首字母大写）

# 判断
print(s.isupper())    # False
print(s.islower())    # False
print(s.istitle())    # True

# 实际应用
def format_name(name):
    return name.strip().title()

print(format_name("alice SMITH"))  # "Alice Smith"

# casefold（更强的lower）
s1 = "ß"
print(s1.lower())     # "ß"
print(s1.casefold())  # "ss"（德语字符）

# 用于不区分大小写的比较
def case_insensitive_equal(s1, s2):
    return s1.casefold() == s2.casefold()

print(case_insensitive_equal("Hello", "HELLO"))  # True
```

---

## 第71题：字符串分割与连接

**问题**：字符串的分割和连接方法

**答案**：
```python
# split（分割）
s = "apple,banana,orange"
fruits = s.split(',')
print(fruits)  # ['apple', 'banana', 'orange']

# 限制分割次数
s = "a,b,c,d,e"
print(s.split(',', 2))  # ['a', 'b', 'c,d,e']

# rsplit（从右边分割）
print(s.rsplit(',', 2))  # ['a,b,c', 'd', 'e']

# 按空白分割（默认）
s = "hello  world\tpython\ncode"
print(s.split())  # ['hello', 'world', 'python', 'code']

# splitlines（按行分割）
s = "line1\nline2\rline3\r\nline4"
print(s.splitlines())  # ['line1', 'line2', 'line3', 'line4']

# partition（分割为三部分）
s = "hello-world-python"
print(s.partition('-'))  # ('hello', '-', 'world-python')
print(s.rpartition('-')) # ('hello-world', '-', 'python')

# join（连接）
fruits = ['apple', 'banana', 'orange']
s = ','.join(fruits)
print(s)  # "apple,banana,orange"

# 连接路径
path = '/'.join(['home', 'user', 'documents'])

# 实际应用：CSV处理
data = [['Name', 'Age'], ['Alice', '25'], ['Bob', '30']]
for row in data:
    print(','.join(row))
```

---

## 第72题：字符串判断方法

**问题**：字符串内容判断方法

**答案**：
```python
# 判断字符类型
print("123".isdigit())     # True（数字）
print("abc".isalpha())     # True（字母）
print("abc123".isalnum())  # True（字母或数字）
print("   ".isspace())     # True（空白字符）

# 判断大小写
print("ABC".isupper())     # True
print("abc".islower())     # True
print("Hello World".istitle())  # True

# 判断标识符
print("var_name".isidentifier())  # True
print("123abc".isidentifier())    # False

# 判断可打印字符
print("hello".isprintable())  # True
print("hello\n".isprintable())  # False

# 判断数字（更强）
print("123".isdecimal())   # True（0-9）
print("①②③".isdigit())     # True（包括上标等）
print("½".isnumeric())     # True（包括分数）

# 实际应用：验证输入
def validate_username(username):
    if not username:
        return False, "用户名不能为空"
    if not username[0].isalpha():
        return False, "用户名必须以字母开头"
    if not username.isalnum() and '_' not in username:
        return False, "用户名只能包含字母、数字和下划线"
    return True, "有效"

# 验证手机号
def validate_phone(phone):
    phone = phone.replace('-', '').replace(' ', '')
    return phone.isdigit() and len(phone) == 11
```

---

## 第73题：字符串编码与解码

**问题**：字符串的编码和解码操作

**答案**：
```python
# 编码（str -> bytes）
s = "你好，世界！"
b = s.encode('utf-8')
print(b)  # b'\xe4\xbd\xa0\xe5\xa5\xbd...'
print(type(b))  # <class 'bytes'>

# 不同编码
b_utf8 = s.encode('utf-8')
b_gbk = s.encode('gbk')
print(len(b_utf8))  # 18
print(len(b_gbk))   # 12

# 解码（bytes -> str）
s = b.decode('utf-8')
print(s)  # "你好，世界！"

# 处理编码错误
b = b'\xff\xfe'
# s = b.decode('utf-8')  # UnicodeDecodeError

# 忽略错误
s = b.decode('utf-8', errors='ignore')

# 替换错误字符
s = b.decode('utf-8', errors='replace')  # 用�替换

# 实际应用：读取文件
with open('file.txt', 'r', encoding='utf-8') as f:
    content = f.read()

# bytes对象操作
b = b'hello'
print(b[0])  # 104（ASCII码）
print(b.upper())  # b'HELLO'
print(b.replace(b'h', b'H'))  # b'Hello'
```

---

## 第74题：字符串切片高级用法

**问题**：字符串切片的各种技巧

**答案**：
```python
s = "Hello, World!"

# 基本切片
print(s[0:5])    # "Hello"
print(s[7:12])   # "World"
print(s[:5])     # "Hello"
print(s[7:])     # "World!"
print(s[:])      # "Hello, World!"（复制）

# 步长
print(s[::2])    # "Hlo ol!"（每隔一个）
print(s[1::2])   # "el,Wrd"
print(s[::-1])   # "!dlroW ,olleH"（反转）

# 负索引
print(s[-6:-1])  # "World"
print(s[-6:])    # "World!"

# 截断字符串
def truncate(s, length, suffix='...'):
    if len(s) <= length:
        return s
    return s[:length-len(suffix)] + suffix

print(truncate("Hello, World!", 10))  # "Hello, ..."

# 提取文件扩展名
filename = "document.txt"
ext = filename[filename.rfind('.'):]
print(ext)  # ".txt"

# 或使用负索引
ext = filename[-4:]

# 反转字符串
def reverse_string(s):
    return s[::-1]

# 每隔n个字符插入分隔符
def insert_separator(s, n, sep=' '):
    return sep.join([s[i:i+n] for i in range(0, len(s), n)])

print(insert_separator("1234567890", 3))  # "123 456 789 0"
```

---

## 第75题：字符串对齐与填充

**问题**：字符串的对齐和填充方法

**答案**：
```python
s = "hello"

# ljust（左对齐）
print(s.ljust(10))       # "hello     "
print(s.ljust(10, '*'))  # "hello*****"

# rjust（右对齐）
print(s.rjust(10))       # "     hello"
print(s.rjust(10, '*'))  # "*****hello"

# center（居中）
print(s.center(10))      # "  hello   "
print(s.center(10, '*')) # "**hello***"

# zfill（用0填充）
print("42".zfill(5))     # "00042"
print("-42".zfill(5))    # "-0042"（保留符号）

# 实际应用：格式化表格
def print_table(data):
    # 计算每列最大宽度
    col_widths = [max(len(str(row[i])) for row in data)
                  for i in range(len(data[0]))]

    for row in data:
        print(' | '.join(str(item).ljust(width)
                         for item, width in zip(row, col_widths)))

data = [
    ['Name', 'Age', 'City'],
    ['Alice', 25, 'NYC'],
    ['Bob', 30, 'LA']
]
print_table(data)

# 格式化金额
def format_amount(amount):
    return f"${amount:,.2f}".rjust(15)

print(format_amount(1234567.89))  # "  $1,234,567.89"
```

---

## 第76题：正则表达式基础

**问题**：使用re模块进行字符串匹配

**答案**：
```python
import re

# 基本匹配
pattern = r'\d+'  # 匹配数字
text = "I have 3 apples and 5 bananas"

# search（查找第一个匹配）
match = re.search(pattern, text)
if match:
    print(match.group())  # "3"

# findall（查找所有匹配）
matches = re.findall(pattern, text)
print(matches)  # ['3', '5']

# match（从开头匹配）
text = "123abc"
match = re.match(r'\d+', text)
print(match.group())  # "123"

# finditer（返回迭代器）
for match in re.finditer(pattern, text):
    print(match.group(), match.start(), match.end())

# sub（替换）
text = "I have 3 apples and 5 bananas"
result = re.sub(r'\d+', 'X', text)
print(result)  # "I have X apples and X bananas"

# split（分割）
text = "apple,banana;orange:grape"
parts = re.split(r'[,;:]', text)
print(parts)  # ['apple', 'banana', 'orange', 'grape']

# 编译正则表达式
pattern = re.compile(r'\d+')
matches = pattern.findall(text)

# 实际应用：验证邮箱
def validate_email(email):
    pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
    return re.match(pattern, email) is not None
```

---

## 第77题：字符串不可变性

**问题**：理解字符串的不可变性

**答案**：
```python
# 字符串不可变
s = "hello"
# s[0] = 'H'  # TypeError: 'str' object does not support item assignment

# "修改"实际是创建新字符串
s = "hello"
s = s.upper()  # 创建新字符串
print(s)  # "HELLO"

# 性能影响
# 不好的做法（每次循环都创建新字符串）
result = ""
for i in range(1000):
    result += str(i)  # 慢

# 好的做法（使用列表）
result = []
for i in range(1000):
    result.append(str(i))
result = ''.join(result)  # 快

# 使用StringIO
from io import StringIO
output = StringIO()
for i in range(1000):
    output.write(str(i))
result = output.getvalue()

# 性能对比
import timeit

def concat():
    s = ""
    for i in range(1000):
        s += str(i)
    return s

def join_method():
    return ''.join(str(i) for i in range(1000))

print(timeit.timeit(concat, number=100))      # 慢
print(timeit.timeit(join_method, number=100)) # 快

# 内存优化
s1 = "hello"
s2 = "hello"
print(s1 is s2)  # True（字符串驻留）
```

---

## 第78题：字符串常用技巧

**问题**：字符串处理的实用技巧

**答案**：
```python
# 1. 反转字符串
s = "hello"
reversed_s = s[::-1]

# 2. 检查回文
def is_palindrome(s):
    s = s.lower().replace(' ', '')
    return s == s[::-1]

print(is_palindrome("A man a plan a canal Panama"))  # True

# 3. 统计字符出现次数
from collections import Counter
s = "hello world"
counts = Counter(s)
print(counts.most_common(3))

# 4. 删除重复字符（保持顺序）
def remove_duplicates(s):
    seen = set()
    result = []
    for char in s:
        if char not in seen:
            seen.add(char)
            result.append(char)
    return ''.join(result)

print(remove_duplicates("hello"))  # "helo"

# 5. 压缩字符串
def compress(s):
    if not s:
        return ""
    result = []
    count = 1
    for i in range(1, len(s)):
        if s[i] == s[i-1]:
            count += 1
        else:
            result.append(s[i-1] + str(count))
            count = 1
    result.append(s[-1] + str(count))
    compressed = ''.join(result)
    return compressed if len(compressed) < len(s) else s

print(compress("aabcccccaaa"))  # "a2b1c5a3"

# 6. 单词首字母缩写
def abbreviate(s):
    return ''.join(word[0].upper() for word in s.split())

print(abbreviate("for your information"))  # "FYI"

# 7. 驼峰转下划线
def camel_to_snake(s):
    result = [s[0].lower()]
    for char in s[1:]:
        if char.isupper():
            result.append('_')
            result.append(char.lower())
        else:
            result.append(char)
    return ''.join(result)

print(camel_to_snake("getUserName"))  # "get_user_name"
```

---

## 第79题：字符串模板

**问题**：使用string.Template进行模板替换

**答案**：
```python
from string import Template

# 基本用法
template = Template("Hello, $name! You are $age years old.")
result = template.substitute(name="Alice", age=25)
print(result)  # "Hello, Alice! You are 25 years old."

# 使用字典
data = {'name': 'Bob', 'age': 30}
result = template.substitute(data)

# safe_substitute（缺少变量不报错）
template = Template("Hello, $name! Welcome to $city.")
result = template.safe_substitute(name="Alice")
print(result)  # "Hello, Alice! Welcome to $city."

# $$ 转义
template = Template("Price: $$${price}")
result = template.substitute(price=9.99)
print(result)  # "Price: $$9.99"

# 自定义分隔符
class MyTemplate(Template):
    delimiter = '#'

template = MyTemplate("Hello, #name!")
result = template.substitute(name="Alice")

# 实际应用：邮件模板
email_template = Template("""
Dear $name,

Your order #$order_id has been confirmed.
Total amount: $$${amount}

Thank you for your purchase!
""")

result = email_template.substitute(
    name="Alice",
    order_id="12345",
    amount="99.99"
)
print(result)

# SQL查询模板
sql_template = Template("SELECT * FROM $table WHERE $column = '$value'")
query = sql_template.substitute(
    table="users",
    column="name",
    value="Alice"
)
```

---

## 第80题：字符串intern机制

**问题**：理解Python的字符串驻留机制

**答案**：
```python
# 字符串驻留（String Interning）
a = "hello"
b = "hello"
print(a is b)  # True（相同的字符串对象）

# 仅对标识符式的字符串有效
a = "hello world"
b = "hello world"
print(a is b)  # 可能False

# 运行时创建的字符串
a = "hello"
b = "".join(['h', 'e', 'l', 'l', 'o'])
print(a == b)  # True（值相等）
print(a is b)  # False（不同对象）

# 手动驻留
import sys
a = sys.intern("hello world")
b = sys.intern("hello world")
print(a is b)  # True

# 优势：节省内存，加快比较
# 应用场景：
# 1. 字典的键
# 2. 大量重复的字符串
# 3. 配置常量

# 测试
import sys

# 不使用intern
strings = ['user_{}'.format(i % 100) for i in range(10000)]
print(sys.getsizeof(strings))

# 使用intern
strings = [sys.intern('user_{}'.format(i % 100)) for i in range(10000)]
print(sys.getsizeof(strings))  # 可能更小
```

---

## 第81题：多行字符串处理

**问题**：处理多行字符串的技巧

**答案**：
```python
# 方法1: 三引号
text = """
This is a
multi-line
string
"""

# 方法2: 括号隐式连接
text = (
    "This is a "
    "multi-line "
    "string"
)

# 方法3: 反斜杠
text = "This is a \
multi-line \
string"

# 删除每行前导空格
text = """\
    line 1
    line 2
    line 3
"""

# 使用textwrap
import textwrap

# 去除缩进
text = textwrap.dedent("""\
    line 1
    line 2
    line 3
""")

# 填充文本
text = "This is a very long line that needs to be wrapped."
wrapped = textwrap.fill(text, width=20)
print(wrapped)

# 缩进文本
text = "line 1\nline 2"
indented = textwrap.indent(text, '    ')

# 实际应用：格式化SQL
sql = textwrap.dedent("""
    SELECT name, age, city
    FROM users
    WHERE age > 18
    ORDER BY name
""").strip()

# 格式化帮助文档
help_text = textwrap.dedent("""
    Usage: program [options]

    Options:
      -h, --help     Show this help message
      -v, --version  Show version
""").strip()
```

---

## 第82题：字符串与列表转换

**问题**：字符串和列表的相互转换

**答案**：
```python
# 字符串转列表
s = "hello"
chars = list(s)
print(chars)  # ['h', 'e', 'l', 'l', 'o']

# 分割成单词列表
s = "hello world python"
words = s.split()
print(words)  # ['hello', 'world', 'python']

# 列表转字符串
chars = ['h', 'e', 'l', 'l', 'o']
s = ''.join(chars)
print(s)  # "hello"

words = ['hello', 'world', 'python']
s = ' '.join(words)
print(s)  # "hello world python"

# 实际应用：反转单词顺序
s = "hello world python"
words = s.split()
reversed_s = ' '.join(reversed(words))
print(reversed_s)  # "python world hello"

# 或使用切片
reversed_s = ' '.join(s.split()[::-1])

# 反转每个单词
def reverse_words(s):
    return ' '.join(word[::-1] for word in s.split())

print(reverse_words("hello world"))  # "olleh dlrow"

# 字符串排序
s = "hello"
sorted_s = ''.join(sorted(s))
print(sorted_s)  # "ehllo"

# 删除元音字母
def remove_vowels(s):
    vowels = 'aeiouAEIOU'
    return ''.join([c for c in s if c not in vowels])

print(remove_vowels("hello world"))  # "hll wrld"
```

---

## 第83题：字符串哈希与比较

**问题**：字符串的哈希和比较操作

**答案**：
```python
# 哈希值
s1 = "hello"
s2 = "hello"
print(hash(s1))
print(hash(s1) == hash(s2))  # True

# 字符串比较（字典序）
print("apple" < "banana")  # True
print("apple" > "Apple")   # True（小写字母>大写）

# 忽略大小写比较
s1 = "Hello"
s2 = "HELLO"
print(s1.lower() == s2.lower())  # True
print(s1.casefold() == s2.casefold())  # True（更强）

# 排序
words = ['banana', 'Apple', 'cherry', 'date']
print(sorted(words))  # 区分大小写
print(sorted(words, key=str.lower))  # 不区分大小写

# 实际应用：查找相似字符串
def similarity(s1, s2):
    """计算两个字符串的相似度"""
    s1, s2 = s1.lower(), s2.lower()
    matches = sum(c1 == c2 for c1, c2 in zip(s1, s2))
    return matches / max(len(s1), len(s2))

print(similarity("hello", "hallo"))  # 0.8

# Levenshtein距离（编辑距离）
def levenshtein_distance(s1, s2):
    if len(s1) < len(s2):
        return levenshtein_distance(s2, s1)
    if len(s2) == 0:
        return len(s1)

    previous_row = range(len(s2) + 1)
    for i, c1 in enumerate(s1):
        current_row = [i + 1]
        for j, c2 in enumerate(s2):
            insertions = previous_row[j + 1] + 1
            deletions = current_row[j] + 1
            substitutions = previous_row[j] + (c1 != c2)
            current_row.append(min(insertions, deletions, substitutions))
        previous_row = current_row

    return previous_row[-1]

print(levenshtein_distance("kitten", "sitting"))  # 3
```

---

## 第84题：字符串性能优化

**问题**：字符串操作的性能优化技巧

**答案**：
```python
import timeit

# 1. 字符串连接
# 慢：使用+
def concat_plus():
    s = ""
    for i in range(1000):
        s = s + str(i)
    return s

# 快：使用join
def concat_join():
    return ''.join(str(i) for i in range(1000))

print(timeit.timeit(concat_plus, number=100))
print(timeit.timeit(concat_join, number=100))

# 2. 字符串格式化
name = "Alice"
age = 25

# 慢
def format_percent():
    return "Name: %s, Age: %d" % (name, age)

# 快
def format_fstring():
    return f"Name: {name}, Age: {age}"

# 3. 成员检查
# 使用set而不是list
chars_list = list("abcdefghijklmnopqrstuvwxyz")
chars_set = set("abcdefghijklmnopqrstuvwxyz")

def check_list():
    return 'z' in chars_list

def check_set():
    return 'z' in chars_set

print(timeit.timeit(check_list, number=100000))
print(timeit.timeit(check_set, number=100000))  # 快得多

# 4. 预编译正则表达式
import re

pattern_str = r'\d+'
pattern_compiled = re.compile(r'\d+')
text = "I have 123 apples"

def use_str():
    return re.findall(pattern_str, text)

def use_compiled():
    return pattern_compiled.findall(text)

# 5. 使用局部变量
def process_string(s):
    # 慢：每次都查找方法
    return [c.upper() for c in s]

def process_string_fast(s):
    # 快：使用局部变量
    upper = str.upper
    return [upper(c) for c in s]
```

---

## 第85题：字符串安全性

**问题**：字符串处理的安全注意事项

**答案**：
```python
# 1. SQL注入防护
# 危险：字符串拼接
username = input("Username: ")
# sql = f"SELECT * FROM users WHERE name = '{username}'"  # 危险！
# 如果输入：' OR '1'='1

# 安全：使用参数化查询
# cursor.execute("SELECT * FROM users WHERE name = ?", (username,))

# 2. 命令注入防护
import subprocess

# 危险
filename = input("Filename: ")
# subprocess.call(f"cat {filename}", shell=True)  # 危险！

# 安全
subprocess.call(["cat", filename])

# 3. XSS防护
import html

user_input = "<script>alert('XSS')</script>"
safe_output = html.escape(user_input)
print(safe_output)  # &lt;script&gt;alert('XSS')&lt;/script&gt;

# 4. 路径遍历防护
import os

def safe_join(base, *paths):
    """安全地连接路径"""
    final_path = os.path.join(base, *paths)
    # 检查是否超出base目录
    if not os.path.abspath(final_path).startswith(os.path.abspath(base)):
        raise ValueError("路径遍历攻击")
    return final_path

# 5. 密码处理
import hashlib
import secrets

def hash_password(password):
    """安全地哈希密码"""
    salt = secrets.token_hex(16)
    pwd_hash = hashlib.pbkdf2_hmac('sha256',
                                    password.encode('utf-8'),
                                    salt.encode('utf-8'),
                                    100000)
    return salt + pwd_hash.hex()

# 6. 验证和清理输入
def sanitize_input(s):
    """清理用户输入"""
    # 删除控制字符
    s = ''.join(char for char in s if char.isprintable())
    # 限制长度
    s = s[:1000]
    # 删除前后空白
    s = s.strip()
    return s

# 7. 避免时序攻击
import hmac

def constant_time_compare(a, b):
    """常量时间比较"""
    return hmac.compare_digest(a, b)
```

---

## 学习笔记

在这里记录你的学习心得和遇到的问题：

```
日期：

重点知识：
- 字符串格式化（f-string推荐）
- 字符串不可变性及性能影响
- 正则表达式的使用
- 安全性注意事项

易错点：
- 字符串拼接性能问题
- 编码解码错误处理
- in操作符对字符串和列表的不同

实践心得：
```

---

## 进度跟踪

完成题目：0/20

- [ ] 第66题 - [ ] 第67题 - [ ] 第68题 - [ ] 第69题 - [ ] 第70题
- [ ] 第71题 - [ ] 第72题 - [ ] 第73题 - [ ] 第74题 - [ ] 第75题
- [ ] 第76题 - [ ] 第77题 - [ ] 第78题 - [ ] 第79题 - [ ] 第80题
- [ ] 第81题 - [ ] 第82题 - [ ] 第83题 - [ ] 第84题 - [ ] 第85题
